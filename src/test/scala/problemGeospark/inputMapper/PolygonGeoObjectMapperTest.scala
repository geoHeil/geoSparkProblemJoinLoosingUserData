// Copyright (C) 2017 Georg Heiler
package problemGeospark.inputMapper

import com.holdenkarau.spark.testing.{ DatasetSuiteBase, SharedSparkContext }
import org.scalatest.FunSuite
import problemGeospark.inputMapper.PolygonGeoObjectMapper

// TODO find out what is wrong here. works fine on console, will not compile during test in IDE!
class PolygonGeoObjectMapperTest extends FunSuite with SharedSparkContext with DatasetSuiteBase {
  test("test parsing of polygons") {
    import spark.implicits._
    val regularData = Seq(PolygonGeoObject(
      "fooBar", -50, "POLYGON ((16.5274266633388 47.8481244466704," +
        " 16.5274266633388 47.8470133355592, 16.5290933300056 " +
        "47.8470133355592, 16.5290933300056 47.8481244466704, 16.5274266633388 47.8481244466704))"
    ))
    val df = regularData.toDS
    val geoObjects = df.rdd.mapPartitions(PolygonGeoObjectMapper.map).first
    assert(geoObjects.getUserData.asInstanceOf[String] === "fooBar;-50")
  }

  test("test parsing of multipolygons") {
    import spark.implicits._
    val regularData = Seq(PolygonGeoObject("fooBar", -70,
      "MULTIPOLYGON (((16.525759996672 47.845902224448, 16.5274266633388 47.845902224448, 16.5290933300056 47.845902224448, 16.5290933300056 47.8470133355592, 16.531315552228 47.8470133355592, 16.531315552228 47.8481244466704, 16.5329822188948 47.8481244466704, 16.5329822188948 47.8497911133372, 16.5346488855616 47.8497911133372, 16.5363155522284 47.8497911133372, 16.5379822188952 47.8497911133372, 16.5379822188952 47.8509022244484, 16.5379822188952 47.8531244466708, 16.5363155522284 47.8531244466708, 16.5363155522284 47.8520133355596, 16.5346488855616 47.8520133355596, 16.5329822188948 47.8520133355596, 16.5329822188948 47.8531244466708, 16.531315552228 47.8531244466708, 16.5290933300056 47.8531244466708, 16.5274266633388 47.8531244466708, 16.525759996672 47.8531244466708, 16.525759996672 47.8520133355596, 16.525759996672 47.8497911133372, 16.525759996672 47.8481244466704, 16.525759996672 47.8470133355592, 16.525759996672 47.845902224448)), ((16.5346488855616 47.845902224448, 16.5379822188952 47.845902224448, 16.539648885562 47.845902224448, 16.5413155522288 47.845902224448, 16.5413155522288 47.8470133355592, 16.539648885562 47.8470133355592, 16.5379822188952 47.8470133355592, 16.5346488855616 47.8470133355592, 16.5346488855616 47.845902224448)), ((16.5240933300052 47.8531244466708, 16.525759996672 47.8531244466708, 16.525759996672 47.854235557782, 16.525759996672 47.8553466688932, 16.525759996672 47.8564577800044, 16.5240933300052 47.8564577800044, 16.5240933300052 47.8553466688932, 16.5240933300052 47.854235557782, 16.5240933300052 47.8531244466708)), ((16.5379822188952 47.8575688911156, 16.539648885562 47.8575688911156, 16.5413155522288 47.8575688911156, 16.5429822188956 47.8575688911156, 16.5446488855624 47.8575688911156, 16.5446488855624 47.8586800022268, 16.5429822188956 47.8586800022268, 16.5413155522288 47.8586800022268, 16.5413155522288 47.859791113338, 16.539648885562 47.859791113338, 16.539648885562 47.8586800022268, 16.5379822188952 47.8586800022268, 16.5379822188952 47.8575688911156)), ((16.531315552228 47.8586800022268, 16.5329822188948 47.8586800022268, 16.5329822188948 47.859791113338, 16.531315552228 47.859791113338, 16.531315552228 47.8586800022268)), ((16.5446488855624 47.8586800022268, 16.5463155522292 47.8586800022268, 16.547982218896 47.8586800022268, 16.547982218896 47.859791113338, 16.5463155522292 47.859791113338, 16.5446488855624 47.859791113338, 16.5446488855624 47.8586800022268)), ((16.5529822188964 47.8631244466716, 16.5552044411188 47.8631244466716, 16.5552044411188 47.8642355577828, 16.5529822188964 47.8642355577828, 16.5529822188964 47.8631244466716)))"))

    val df = regularData.toDS
    val geoObjects = df.rdd.mapPartitions(PolygonGeoObjectMapper.map).first
    assert(geoObjects.getUserData.asInstanceOf[String] === "fooBar;-70")
  }
}